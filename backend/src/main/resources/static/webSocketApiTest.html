<!DOCTYPE html>
<html>
<head>
    <title>WebSocket API Test</title>
</head>
<body>
<h1>WebSocket API Test</h1>
<button id="connectButton">Connect</button>
<button id="disconnectButton" disabled>Disconnect</button>
<button id="sendMessageButton" disabled>Send Message</button>
<button id="sendMessageToOneButton" disabled>Send To One</button>
<button id="sendEnterButton" disabled>Send Enter</button>
<button id="eventToOneButton" disabled>Event To One</button>
<br>
<input type="text" id="messageInput" placeholder="Enter message">
<input type="text" id="roomInput" placeholder="Enter room">
<br>
<div id="messages"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>

<script>
    let stompClient = null;

    const connectButton = document.getElementById('connectButton');
    const disconnectButton = document.getElementById('disconnectButton');
    const sendMessageButton = document.getElementById('sendMessageButton');
    const sendMessageToOneButton = document.getElementById('sendMessageToOneButton');
    const eventToOneButton = document.getElementById('eventToOneButton');
    const sendEnterButton = document.getElementById('sendEnterButton');
    const messageInput = document.getElementById('messageInput');
    const roomInput = document.getElementById('roomInput');
    const messagesDiv = document.getElementById('messages');

    function showMessage(message) {
        const p = document.createElement('p');
        p.innerText = message;
        messagesDiv.appendChild(p);
    }

    function connect() {
        const socket = new SockJS('/ssafish');
        stompClient = Stomp.over(socket);

        stompClient.heartbeat.outgoing = 5000;
        stompClient.heartbeat.incoming = 5000;

        stompClient.connect({}, function(frame) {
            connectButton.disabled = true;
            disconnectButton.disabled = false;
            sendMessageButton.disabled = false;
            sendMessageToOneButton.disabled = false;
            sendEnterButton.disabled = false;
            eventToOneButton.disabled = false;
            showMessage('Connected');

            // Replace roomId with the appropriate room ID
            const roomId = 123; // Replace with the desired room ID

            stompClient.subscribe(`/sub/${roomId}`, function(message) {
                showMessage(JSON.parse(message.body).userId + " : " + JSON.parse(message.body).content);
            });
        });
    }

    function disconnect() {
        if (stompClient !== null) {
            stompClient.disconnect();
            connectButton.disabled = false;
            disconnectButton.disabled = true;
            sendMessageButton.disabled = true;
            sendMessageToOneButton.disabled = true;
            sendEnterButton.disabled = true;
            eventToOneButton.disabled = true;
            showMessage('Disconnected');
        }
    }

    function sendMessage() {
        const message = messageInput.value;

        // Replace roomId with the appropriate room ID
        const roomId = 123; // Replace with the desired room ID

        stompClient.send(`/pub/msg/${roomId}`, {}, JSON.stringify({ 'userId': 77, 'content': message }));
        messageInput.value = '';
    }

    function sendMessageToOne() {
        const message = messageInput.value;

        const roomId = roomInput.value;

        stompClient.send(`/pub/msg/${roomId}`, {}, JSON.stringify({ 'userId': 77, 'content': message }));
        messageInput.value = '';
    }

    function sendEnter() {

        // Replace roomId with the appropriate room ID
        const roomId = 123; // Replace with the desired room ID

        stompClient.send(`/pub/enter/${roomId}`, {}, JSON.stringify({ 'userId': 77 }));
    }

    function eventToOne() {
        const postData = {
            roomId: roomInput.value,
            content: messageInput.value
        };

        const postUrl = '/api/v1/room/msg'

        axios.post(postUrl, postData)
            .then(response => {
                console.log('Response: ', response.data);
            })
            .catch(error => {
                console.error('Error: ', error);
            })

    }

    connectButton.addEventListener('click', connect);
    disconnectButton.addEventListener('click', disconnect);
    sendMessageButton.addEventListener('click', sendMessage);
    sendMessageToOneButton.addEventListener('click', sendMessageToOne);
    sendEnterButton.addEventListener('click', sendEnter);
    eventToOneButton.addEventListener('click', eventToOne);
</script>
</body>
</html>